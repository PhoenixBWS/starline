export default class starline{constructor(t,i={}){this.selector=t,this.speed=i?.speed||100,this.radius=i?.radius||0,this.gap=i?.gap||32,this.height=i?.height||96,this.width=i?.width||128,this.mode="horizontal",this.hoverPause=i?.hoverPause||!1,"string"==typeof i.mode&&["horizontal","vertical"].includes(i.mode.toLowerCase())&&(this.mode=i.mode.toLowerCase()),this.playState=!0,this.ima=[],this.imwh=[],this.#t()}#i(t,i,e,h,s,a){t.beginPath(),t.moveTo(i+a,e),t.lineTo(i+h-a,e),t.quadraticCurveTo(i+h,e,i+h,e+a),t.lineTo(i+h,e+s-a),t.quadraticCurveTo(i+h,e+s,i+h-a,e+s),t.lineTo(i+a,e+s),t.quadraticCurveTo(i,e+s,i,e+s-a),t.lineTo(i,e+a),t.quadraticCurveTo(i,e,i+a,e),t.closePath(),t.clip()}#e(t,i,e,h,s){i.clearRect(0,0,t.width,t.height);let a=h,n=e;for(;n<t.width;)a===this.imwh.length&&(a=0),i.save(),this.#i(i,n,0,this.imwh[a],t.height,this.radius),i.drawImage(this.ima[a],n,0,this.imwh[a],t.height),i.restore(),n+=this.imwh[a]+this.gap,a++;requestAnimationFrame((a=>{let n=(a-s)*this.speed/1e3;this.hoverPause&&!this.playState&&(n=0);let r=e-n;r<=-(this.imwh[h]+this.gap)&&(r=0,++h>=this.imwh.length&&(h=0)),this.#e(t,i,r,h,a)}))}#h(t,i,e,h,s){i.clearRect(0,0,t.width,t.height);let a=h,n=e;for(;n<t.width;)a===this.imwh.length&&(a=0),i.save(),this.#i(i,n,0,this.imwh[a],t.height,this.radius),i.drawImage(this.ima[a],n,0,this.imwh[a],t.height),i.restore(),n+=this.imwh[a]+this.gap,a++;requestAnimationFrame((a=>{let n=(a-s)*this.speed/1e3;this.hoverPause&&!this.playState&&(n=0);let r=e-n;r>=this.gap&&(--h<0&&(h=this.imwh.length-1),r=-this.imwh[h]),this.#h(t,i,r,h,a)}))}#s(t,i,e,h,s){i.clearRect(0,0,t.width,t.height);let a=h,n=e;for(;n<t.height;)a===this.imwh.length&&(a=0),i.save(),this.#i(i,0,n,t.width,this.imwh[a],this.radius),i.drawImage(this.ima[a],0,n,t.width,this.imwh[a]),i.restore(),n+=this.imwh[a]+this.gap,a++;requestAnimationFrame((a=>{let n=(a-s)*this.speed/1e3;this.playState||(n=0);let r=e-n;r<=-(this.imwh[h]+this.gap)&&(r=0,++h>=this.imwh.length&&(h=0)),this.#s(t,i,r,h,a)}))}#a(t,i,e,h,s){i.clearRect(0,0,t.width,t.height);let a=h,n=e;for(;n<t.height;)a===this.imwh.length&&(a=0),i.save(),this.#i(i,0,n,t.width,this.imwh[a],this.radius),i.drawImage(this.ima[a],0,n,t.width,this.imwh[a]),i.restore(),n+=this.imwh[a]+this.gap,a++;requestAnimationFrame((a=>{let n=(a-s)*this.speed/1e3;this.playState||(n=0);let r=e-n;r>this.gap&&(--h<0&&(h=this.imwh.length-1),r=-this.imwh[h]),this.#a(t,i,r,h,a)}))}#n(t,i){requestAnimationFrame((e=>{switch(this.mode){case"horizontal":this.speed>=0?this.#e(t,i,0,0,e):this.#h(t,i,0,0,e);break;case"vertical":this.speed>=0?this.#s(t,i,0,0,e):this.#a(t,i,0,0,e)}}))}#t(){try{document.querySelectorAll(this.selector).forEach((t=>{const i=t.getContext("2d"),e=t.getAttribute("data-starline-srcset").split(",").map((t=>t.trim()));let h=0;if("horizontal"==this.mode){if(t.width=t.parentElement.clientWidth,"number"==typeof this.height)t.height=this.height;else if("string"==typeof this.height){const i=document.createElement("div");i.style.setProperty("position","absolute"),i.style.setProperty("height",this.height),t.parentElement.appendChild(i),t.height=i.getBoundingClientRect().height,i.remove()}else t.height=96;for(let s=0;s<e.length;s++)this.ima[s]=new Image,this.ima[s].src=e[s],this.ima[s].onload=()=>{this.imwh[s]=this.ima[s].naturalWidth*t.height/this.ima[s].naturalHeight,h++,h===e.length&&this.#n(t,i)}}else{if(t.height=t.parentElement.clientHeight,"number"==typeof this.width)t.width=this.width;else if("string"==typeof this.width){const i=document.createElement("div");i.style.setProperty("position","absolute"),i.style.setProperty("width",this.width),t.parentElement.appendChild(i),t.width=i.getBoundingClientRect().width,i.remove()}else t.width=128;for(let s=0;s<e.length;s++)this.ima[s]=new Image,this.ima[s].src=e[s],this.ima[s].onload=()=>{this.imwh[s]=this.ima[s].naturalHeight*t.width/this.ima[s].naturalWidth,h++,h===e.length&&this.#n(t,i)}}this.hoverPause&&(t.addEventListener("mouseenter",(()=>{this.playState=!1})),t.addEventListener("mouseleave",(()=>{this.playState=!0})))})),window.addEventListener("resize",(()=>{document.querySelectorAll(this.selector).forEach((t=>{if("horizontal"===this.mode){if(t.width=t.parentElement.clientWidth,"string"==typeof this.height){const i=document.createElement("div");i.style.setProperty("position","absolute"),i.style.setProperty("height",this.height),t.parentElement.appendChild(i),t.height=i.getBoundingClientRect().height,i.remove();for(let i=0;i<this.ima.length;i++)this.imwh[i]=this.ima[i].naturalWidth*t.height/this.ima[i].naturalHeight}}else if(t.height=t.parentElement.clientHeight,"string"==typeof this.width){const i=document.createElement("div");i.style.setProperty("position","absolute"),i.style.setProperty("width",this.width),t.parentElement.appendChild(i),t.width=i.getBoundingClientRect().width,i.remove();for(let i=0;i<this.ima.length;i++)this.imwh[i]=this.ima[i].naturalHeight*t.width/this.ima[i].naturalWidth}}))}))}catch(t){}}}